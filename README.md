# Horse Race Simulator 🏇

TypeScript로 구현된 고급 경마 시뮬레이션 프로그램입니다. 수학적으로 정확한 닫힌 트랙을 동적 생성하고, 다중 바퀴 경주를 시뮬레이션하며, WebGL 기반 시각화를 제공합니다.

## 🎯 핵심 특징

### ✨ 수학적으로 보장된 트랙 생성

- **절대 조건 준수**: 닫힌 도형, 접선 연결, 직선-코너 교대 패턴
- **자기교차 방지**: 30°-150° 코너 각도로 안전한 트랙 생성
- **동적 패턴**: 임의의 세그먼트 수에 대해 수학적으로 완벽한 트랙 자동 생성

### 🏃‍♂️ 다중 바퀴 경주 시스템

- **경기장보다 긴 경주**: 200m 트랙에서 600m(3바퀴) 경주 가능
- **실시간 바퀴 추적**: 각 말의 현재 바퀴 수와 남은 거리 실시간 계산
- **완벽한 위치 계산**: 여러 바퀴에서도 정확한 2D 좌표 추적

### 🎨 고급 시각화

- **WebGL 렌더링**: 부드러운 애니메이션과 고성능 렌더링
- **동적 카메라**: 트랙 크기에 맞춘 자동 뷰포트 조절
- **실시간 정보**: 바퀴 수, 순위, 거리 등 상세 정보 표시

## 🛠 기술적 혁신

### 수학적 트랙 생성 알고리즘

```typescript
// 절대 조건을 만족하는 트랙 생성
function generateValidTrack(segmentCount: number) {
  // 1. 직선-코너 교대 패턴 강제
  // 2. 자기교차 방지 각도 계산
  // 3. 접선 연결 보장
  // 4. 닫힌 도형 수학적 검증
}
```

### 다중 바퀴 시뮬레이션

```typescript
// 여러 바퀴 도는 위치 계산
const currentPositionInLap = totalDistance % trackLength;
const visualPosition = getTrackPoint(currentPositionInLap);
```

## 📊 시뮬레이션 결과 예시

```
=== 경기장 길이보다 경기 길이가 더 긴 상황 ===
경기장 총 길이: 200m
목표 경기 거리: 600m (3바퀴)

=== 경기 결과 분석 ===
Horse1: 600.0m (3바퀴 + 0.0m)
Horse2: 600.0m (3바퀴 + 0.0m)
우승마: Horse4 (speed=21.94 m/턴, 28턴 완주)
```

## 🚀 빠른 시작

### 설치

```bash
npm install
```

### 실행

```bash
npm start        # 시뮬레이션 실행
npm run build    # TypeScript 빌드
npm run dev      # 개발 모드 (자동 재시작)
```

### 결과 확인

- 콘솔: 상세 경주 통계
- `race-result.html`: WebGL 리플레이 (자동 생성)

## 🏗 아키텍처

### 핵심 모듈

```
src/
├── main.ts              # 진입점 및 경주 설정
├── raceTrack.ts         # 수학적 트랙 생성 엔진
├── raceSimulator.ts     # 다중 바퀴 시뮬레이션 로직
├── raceViewerWebGL.ts   # WebGL 시각화 엔진
├── raceSegment.ts       # 트랙 세그먼트 추상화
├── raceLine.ts          # 직선 세그먼트 (접선 연결)
├── raceCorner.ts        # 코너 세그먼트 (곡률 계산)
└── types/
    ├── horse.ts         # 경주마 데이터 모델
    └── raceLog.ts       # 경주 로그 타입
```

### 데이터 흐름

```
트랙 생성 (수학적 검증)
    ↓
다중 바퀴 시뮬레이션 실행
    ↓
위치 추적 및 로깅
    ↓
WebGL 리플레이 생성
```

## 🎮 고급 기능

### 1. 커스텀 경주 설정

```typescript
// 극한 시나리오: 100m 트랙에서 1000m 경주 (10바퀴)
const track = createTrack(100, 4);
const raceDistance = 1000;
```

### 2. 트랙 품질 검증

- **닫힌 도형 검증**: 시작점-끝점 거리 < 0.000001
- **접선 연속성**: 모든 세그먼트 접선 연결 확인
- **자기교차 방지**: 최대 코너 각도 모니터링

### 3. 성능 최적화

- **적응형 해상도**: 트랙 크기에 따른 동적 포인트 밀도
- **메모리 효율**: 바퀴별 위치 재계산으로 메모리 절약
- **WebGL 가속**: 하드웨어 가속 렌더링

## � 수학적 정확성

### 트랙 생성 보장사항

1. **외각 합 자유**: 360° 제약 없이 자연스러운 형태
2. **접선 연결**: 모든 세그먼트 간 C¹ 연속성
3. **자기교차 금지**: 기하학적으로 안전한 트랙

### 시뮬레이션 정밀도

- **위치 정확도**: 64비트 부동소수점 정밀도
- **각도 계산**: 삼각함수 기반 정확한 방향 벡터
- **거리 측정**: 유클리드 거리 기반 정밀 측정

## 🌟 확장 가능성

### 게임플레이 확장

- 🎲 베팅 시스템 및 배당률
- 🏆 시즌제 리그 및 랭킹
- 🎨 말 커스터마이징 및 능력치

### 기술적 확장

- 🔥 실시간 멀티플레이어
- 🧠 AI 기반 말 행동 패턴
- 📱 모바일 앱 및 웹 버전

### 시뮬레이션 확장

- 🌦 날씨 및 트랙 컨디션
- ⚡ 가속도, 스태미나 시스템
- 🏔 3D 지형 및 고도 변화

## 📜 라이선스

MIT License - 자유롭게 사용, 수정, 배포 가능

---

**개발자**: 수학적 정확성과 시각적 완성도를 추구하는 시뮬레이션 엔진 ⚡
